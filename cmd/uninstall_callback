#!/bin/bash

############################
# 日志函数
############################
MAIN_LOG="/tmp/metatube-fnos.log"
APP_LOG="/tmp/metatube-app.log"

log_message() {
    local msg="$1"
    local ts
    ts=$(date '+%Y-%m-%d %H:%M:%S')
    echo "${ts} [METATUBE] ${msg}" | tee -a "${MAIN_LOG}"
}

log_message "==============卸载结束=============="

if [ "${metatube_data_action}" = "delete" ]; then
    log_message "删除 TRIM_PKGVAR 目录"
    rm -rf "${TRIM_PKGVAR}"
    
    if [ -n "${TRIM_DATA_SHARE_PATHS}" ]; then
        IFS=':' read -ra SHARE_PATHS <<< "${TRIM_DATA_SHARE_PATHS}"
        
        for path in "${SHARE_PATHS[@]}"; do
            if [ -n "$path" ] && [ -d "$path" ]; then
                log_message "删除数据共享目录: $path"
                rm -rf "$path"
            else
                log_message "跳过无效或不存在的数据共享目录: $path"
            fi
        done
    else
        log_message "TRIM_DATA_SHARE_PATHS 未设置，无需删除共享目录"
    fi
fi

log_message "==============卸载结束=============="
exit 0